/*******************************************************************************
** patch.h (patch settings)
*******************************************************************************/

#ifndef PATCH_H
#define PATCH_H

#include "bank.h"
#include "voice.h"

enum
{
  PATCH_ADJUST_MODE_DIRECT = 0, 
  PATCH_ADJUST_MODE_RELATIVE 
};

enum
{
  PATCH_PARAM_ALGORITHM = 0, 
  PATCH_PARAM_HIGHPASS_CUTOFF, 
  PATCH_PARAM_LOWPASS_CUTOFF, 
  PATCH_PARAM_OSC_WAVEFORM, 
  PATCH_PARAM_OSC_FEEDBACK, 
  PATCH_PARAM_OSC_FREQ_MODE, 
  PATCH_PARAM_OSC_MULTIPLE, 
  PATCH_PARAM_OSC_DETUNE_COARSE, 
  PATCH_PARAM_OSC_DETUNE_FINE, 
  PATCH_PARAM_ENV_ATTACK, 
  PATCH_PARAM_ENV_DECAY_1, 
  PATCH_PARAM_ENV_DECAY_2, 
  PATCH_PARAM_ENV_RELEASE, 
  PATCH_PARAM_ENV_AMPLITUDE, 
  PATCH_PARAM_ENV_SUSTAIN, 
  PATCH_PARAM_ENV_RATE_KS, 
  PATCH_PARAM_ENV_LEVEL_KS, 
  PATCH_PARAM_ENV_SPECIAL_MODE, 
  PATCH_PARAM_LFO_WAVEFORM, 
  PATCH_PARAM_LFO_OCTAVE, 
  PATCH_PARAM_LFO_NOTE, 
  PATCH_PARAM_LFO_DELAY, 
  PATCH_PARAM_LFO_SYNC, 
  PATCH_PARAM_LFO_VIBRATO, 
  PATCH_PARAM_LFO_TREMOLO, 
  PATCH_PARAM_LFO_WOBBLE, 
  PATCH_PARAM_MOD_WHEEL_VIBRATO, 
  PATCH_PARAM_MOD_WHEEL_TREMOLO, 
  PATCH_PARAM_MOD_WHEEL_WOBBLE, 
  PATCH_PARAM_AFTERTOUCH_VIBRATO, 
  PATCH_PARAM_AFTERTOUCH_TREMOLO, 
  PATCH_PARAM_AFTERTOUCH_WOBBLE, 
  PATCH_NUM_PARAMS
};

#define PATCH_ALGORITHM_LOWER_BOUND   0
#define PATCH_ALGORITHM_UPPER_BOUND   7
#define PATCH_ALGORITHM_NUM_VALUES    (PATCH_ALGORITHM_UPPER_BOUND - PATCH_ALGORITHM_LOWER_BOUND + 1)

/* filters */
#define PATCH_HIGHPASS_CUTOFF_LOWER_BOUND 0
#define PATCH_HIGHPASS_CUTOFF_UPPER_BOUND 3
#define PATCH_HIGHPASS_CUTOFF_NUM_VALUES  (PATCH_HIGHPASS_CUTOFF_UPPER_BOUND - PATCH_HIGHPASS_CUTOFF_LOWER_BOUND + 1)

#define PATCH_LOWPASS_CUTOFF_LOWER_BOUND  0
#define PATCH_LOWPASS_CUTOFF_UPPER_BOUND  3
#define PATCH_LOWPASS_CUTOFF_NUM_VALUES   (PATCH_LOWPASS_CUTOFF_UPPER_BOUND - PATCH_LOWPASS_CUTOFF_LOWER_BOUND + 1)

/* oscillators */
#define PATCH_OSC_WAVEFORM_LOWER_BOUND  0
#define PATCH_OSC_WAVEFORM_UPPER_BOUND  3
#define PATCH_OSC_WAVEFORM_NUM_VALUES   (PATCH_OSC_WAVEFORM_UPPER_BOUND - PATCH_OSC_WAVEFORM_LOWER_BOUND + 1)

#define PATCH_OSC_FEEDBACK_LOWER_BOUND  0
#define PATCH_OSC_FEEDBACK_UPPER_BOUND  7
#define PATCH_OSC_FEEDBACK_NUM_VALUES   (PATCH_OSC_FEEDBACK_UPPER_BOUND - PATCH_OSC_FEEDBACK_LOWER_BOUND + 1)

#define PATCH_OSC_FREQ_MODE_LOWER_BOUND   0
#define PATCH_OSC_FREQ_MODE_UPPER_BOUND   1
#define PATCH_OSC_FREQ_MODE_NUM_VALUES    (PATCH_OSC_FREQ_MODE_UPPER_BOUND - PATCH_OSC_FREQ_MODE_LOWER_BOUND + 1)

#define PATCH_OSC_MULTIPLE_LOWER_BOUND  0
#define PATCH_OSC_MULTIPLE_UPPER_BOUND  15
#define PATCH_OSC_MULTIPLE_NUM_VALUES   (PATCH_OSC_MULTIPLE_UPPER_BOUND - PATCH_OSC_MULTIPLE_LOWER_BOUND + 1)

#define PATCH_OSC_DETUNE_COARSE_LOWER_BOUND   0
#define PATCH_OSC_DETUNE_COARSE_UPPER_BOUND   3
#define PATCH_OSC_DETUNE_COARSE_NUM_VALUES    (PATCH_OSC_DETUNE_COARSE_UPPER_BOUND - PATCH_OSC_DETUNE_COARSE_LOWER_BOUND + 1)

#define PATCH_OSC_DETUNE_FINE_LOWER_BOUND    -8
#define PATCH_OSC_DETUNE_FINE_UPPER_BOUND     8
#define PATCH_OSC_DETUNE_FINE_NUM_VALUES      (PATCH_OSC_DETUNE_FINE_UPPER_BOUND - PATCH_OSC_DETUNE_FINE_LOWER_BOUND + 1)

/* envelopes */
#define PATCH_ENV_RATE_LOWER_BOUND  1
#define PATCH_ENV_RATE_UPPER_BOUND  32
#define PATCH_ENV_RATE_NUM_VALUES   (PATCH_ENV_RATE_UPPER_BOUND - PATCH_ENV_RATE_LOWER_BOUND + 1)

#define PATCH_ENV_AMPLITUDE_LOWER_BOUND 0
#define PATCH_ENV_AMPLITUDE_UPPER_BOUND 32
#define PATCH_ENV_AMPLITUDE_NUM_VALUES  (PATCH_ENV_AMPLITUDE_UPPER_BOUND - PATCH_ENV_AMPLITUDE_LOWER_BOUND + 1)

#define PATCH_ENV_SUSTAIN_LOWER_BOUND   0
#define PATCH_ENV_SUSTAIN_UPPER_BOUND   16
#define PATCH_ENV_SUSTAIN_NUM_VALUES    (PATCH_ENV_SUSTAIN_UPPER_BOUND - PATCH_ENV_SUSTAIN_LOWER_BOUND + 1)

#define PATCH_ENV_KEYSCALE_LOWER_BOUND  1
#define PATCH_ENV_KEYSCALE_UPPER_BOUND  8
#define PATCH_ENV_KEYSCALE_NUM_VALUES   (PATCH_ENV_KEYSCALE_UPPER_BOUND - PATCH_ENV_KEYSCALE_LOWER_BOUND + 1)

#define PATCH_ENV_SPECIAL_MODE_LOWER_BOUND  0
#define PATCH_ENV_SPECIAL_MODE_UPPER_BOUND  8
#define PATCH_ENV_SPECIAL_MODE_NUM_VALUES   (PATCH_ENV_SPECIAL_MODE_UPPER_BOUND - PATCH_ENV_SPECIAL_MODE_LOWER_BOUND + 1)

/* lfo */
#define PATCH_LFO_WAVEFORM_LOWER_BOUND  0
#define PATCH_LFO_WAVEFORM_UPPER_BOUND  3
#define PATCH_LFO_WAVEFORM_NUM_VALUES   (PATCH_LFO_WAVEFORM_UPPER_BOUND - PATCH_LFO_WAVEFORM_LOWER_BOUND + 1)

#define PATCH_LFO_OCTAVE_LOWER_BOUND  0
#define PATCH_LFO_OCTAVE_UPPER_BOUND  3
#define PATCH_LFO_OCTAVE_NUM_VALUES   (PATCH_LFO_OCTAVE_UPPER_BOUND - PATCH_LFO_OCTAVE_LOWER_BOUND + 1)

#define PATCH_LFO_NOTE_LOWER_BOUND  0
#define PATCH_LFO_NOTE_UPPER_BOUND  12
#define PATCH_LFO_NOTE_NUM_VALUES   (PATCH_LFO_NOTE_UPPER_BOUND - PATCH_LFO_NOTE_LOWER_BOUND + 1)

#define PATCH_LFO_DELAY_LOWER_BOUND 0
#define PATCH_LFO_DELAY_UPPER_BOUND 16
#define PATCH_LFO_DELAY_NUM_VALUES  (PATCH_LFO_DELAY_UPPER_BOUND - PATCH_LFO_DELAY_LOWER_BOUND + 1)

#define PATCH_LFO_SYNC_LOWER_BOUND  0
#define PATCH_LFO_SYNC_UPPER_BOUND  1
#define PATCH_LFO_SYNC_NUM_VALUES   (PATCH_LFO_SYNC_UPPER_BOUND - PATCH_LFO_SYNC_LOWER_BOUND + 1)

/* sensitivities */
#define PATCH_VIBRATO_LOWER_BOUND  0
#define PATCH_VIBRATO_UPPER_BOUND  16
#define PATCH_VIBRATO_NUM_VALUES   (PATCH_VIBRATO_UPPER_BOUND - PATCH_VIBRATO_LOWER_BOUND + 1)

#define PATCH_TREMOLO_LOWER_BOUND  0
#define PATCH_TREMOLO_UPPER_BOUND  16
#define PATCH_TREMOLO_NUM_VALUES   (PATCH_TREMOLO_UPPER_BOUND - PATCH_TREMOLO_LOWER_BOUND + 1)

#define PATCH_WOBBLE_LOWER_BOUND  0
#define PATCH_WOBBLE_UPPER_BOUND  16
#define PATCH_WOBBLE_NUM_VALUES   (PATCH_WOBBLE_UPPER_BOUND - PATCH_WOBBLE_LOWER_BOUND + 1)

typedef struct patch
{
  /* algorithm */
  short int algorithm;

  /* filters */
  short int highpass_cutoff;
  short int lowpass_cutoff;

  /* oscillators */
  short int osc_waveform[VOICE_NUM_OSCS_AND_ENVS];
  short int osc_feedback[VOICE_NUM_OSCS_AND_ENVS];
  short int osc_freq_mode[VOICE_NUM_OSCS_AND_ENVS];
  short int osc_multiple[VOICE_NUM_OSCS_AND_ENVS];
  short int osc_detune_coarse[VOICE_NUM_OSCS_AND_ENVS];
  short int osc_detune_fine[VOICE_NUM_OSCS_AND_ENVS];

  /* envelopes */
  short int env_attack[VOICE_NUM_OSCS_AND_ENVS];
  short int env_decay_1[VOICE_NUM_OSCS_AND_ENVS];
  short int env_decay_2[VOICE_NUM_OSCS_AND_ENVS];
  short int env_release[VOICE_NUM_OSCS_AND_ENVS];
  short int env_amplitude[VOICE_NUM_OSCS_AND_ENVS];
  short int env_sustain[VOICE_NUM_OSCS_AND_ENVS];
  short int env_rate_ks[VOICE_NUM_OSCS_AND_ENVS];
  short int env_level_ks[VOICE_NUM_OSCS_AND_ENVS];
  short int env_special_mode[VOICE_NUM_OSCS_AND_ENVS];

  /* lfo */
  short int lfo_waveform;
  short int lfo_octave;
  short int lfo_note;
  short int lfo_delay;
  short int lfo_sync;
  short int lfo_vibrato;
  short int lfo_tremolo;
  short int lfo_wobble;

  /* mod wheel sensitivity */
  short int mod_wheel_vibrato;
  short int mod_wheel_tremolo;
  short int mod_wheel_wobble;

  /* aftertouch sensitivity */
  short int aftertouch_vibrato;
  short int aftertouch_tremolo;
  short int aftertouch_wobble;
} patch;

/* patch bank */
extern patch G_patch_bank[BANK_NUM_PATCHES];

/* function declarations */
short int patch_setup_all();
short int patch_reset(int patch_index);

short int patch_adjust_parameter( int patch_index, int param, int num, 
                                  int mode, int value);

#endif
